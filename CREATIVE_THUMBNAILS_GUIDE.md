# Creative Thumbnail Loading Guide

## Overview

The Ad Manager now displays creative thumbnails for all your ads across Facebook, TikTok, Google Ads, and other platforms.

## How It Works

### Facebook Ads ‚úÖ Fully Implemented

When you sync your Facebook Ads account, the system automatically fetches:
- **Image creatives**: Direct image URLs
- **Video creatives**: Video thumbnails and URLs
- **Carousel ads**: Primary image/video
- **Dynamic ads**: Product images

**Fields fetched from Facebook Graph API:**
- `creative.thumbnail_url` - Thumbnail for videos
- `creative.image_url` - Direct image URL
- `creative.title` - Ad headline
- `creative.body` - Ad copy
- `creative.video_id` - Video identifier
- `creative.call_to_action_type` - CTA button text
- `creative.object_story_spec` - Additional creative data

### TikTok Ads üîß Ready for Implementation

Infrastructure is in place. Will automatically fetch:
- Video thumbnails
- Video URLs
- Creative text overlays
- Sound/music info

### Google Ads üîß Ready for Implementation

Infrastructure is in place. Will automatically fetch:
- Display ad images
- Responsive display ad images
- Video ad thumbnails
- Shopping ad product images
- *(Note: Search text ads have no visuals)*

### Snapchat Ads üîß Future Support

Will support:
- Snap ad creative images
- Video thumbnails
- AR lens previews

## Getting Thumbnails to Appear

### First Time Setup

1. **Connect your ad platform** (Facebook, TikTok, Google) in Settings
2. **Sync your ad account** - Click "Sync Now" or wait for auto-sync
3. **Refresh the Ad Manager** - Thumbnails will appear in the Creative column

### Updating Existing Data

If you connected your Facebook account before this update:

1. Go to **Settings** ‚Üí **Integrations**
2. Find your Facebook Ads connection
3. Click **"Sync Now"** to re-fetch with creative thumbnails
4. Return to **Ad Manager** - thumbnails will now appear

### Troubleshooting

**Thumbnails not showing?**

Check browser console for debug logs:
```
[AdReportsService] First ad debug: {
  creativeData: {...},
  creativeThumbnailUrl: "https://...",
  creativeType: "image"
}
```

If `creativeThumbnailUrl` is `null`:
- Re-sync your ad account
- Check that ads have active creatives
- Verify Facebook permissions include `ads_read`

**Placeholder icons appearing?**

This means:
- Ad has no creative (rare)
- Creative is deleted in ad platform
- Thumbnail URL is broken (will auto-retry)
- Ad is text-only (Google Search)

## Technical Details

### Database Storage

Creative data is stored in the `ads` table:
```sql
creative_id               # Platform's creative ID
creative_name             # Creative name
creative_thumbnail_url    # Main thumbnail URL
creative_type            # 'image' or 'video'
creative_data            # JSON with full creative info
```

### Frontend Display

The Creative column shows:
- üì¶ **Placeholder** - No thumbnail available
- üñºÔ∏è **Thumbnail** - Hoverable to preview
- üîó **External link** - Click to view in platform's Ads Manager
- üîÑ **Loading spinner** - While image loads

### Image Optimization

Facebook CDN URLs are used as-is (signed URLs).
No resizing or processing to avoid breaking authentication.

## Platform-Specific Notes

### Facebook
- All creative types supported
- High-quality images from CDN
- Video thumbnails auto-generated by Facebook

### TikTok
- Implementation pending
- Will use TikTok's creative API
- Supports video ads only

### Google Ads
- Implementation pending
- Display & video ads supported
- Search text ads have no visuals

### Snapchat
- Future implementation
- Will support Snap ads and AR lenses

## Auto-Detection

When you or Rex AI creates new campaigns/ads:
- ‚úÖ New ads auto-detected on next refresh
- ‚úÖ Thumbnails fetched automatically
- ‚úÖ No manual action required

## Developer Notes

### Sync Function
Located in: `supabase/functions/facebook-ads-sync/index.ts`

Fetches creative fields:
```typescript
const url = `https://graph.facebook.com/v21.0/${adSet.id}/ads?` +
  `fields=id,name,status,creative{` +
    `id,name,title,body,image_url,thumbnail_url,` +
    `video_id,call_to_action_type,object_story_spec` +
  `}`;
```

### Display Logic
Located in: `src/components/reports/CreativeAnalysisEnhanced.tsx`

```typescript
{(creative.thumbnail || creative.url) && !hasImageError ? (
  <img src={creative.thumbnail || creative.url} />
) : (
  <Package className="w-5 h-5 text-gray-400" />
)}
```

### Data Service
Located in: `src/lib/adReportsService.ts`

Transforms database records to display format with proper thumbnail handling.
