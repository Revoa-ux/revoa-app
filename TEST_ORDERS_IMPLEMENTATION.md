# Test Orders Script Implementation - Complete

A simple, manual script to generate 100 test orders in Shopify for validating subscription blocking logic.

## What Was Created

### 1. Main Script: `scripts/create-test-orders.ts`

A standalone TypeScript script that:
- Connects to Supabase to fetch store credentials
- Queries Shopify GraphQL API for available products
- Creates 100 draft orders with test data
- Completes each draft order to make them "real" orders
- Provides progress tracking and error handling

### 2. Package.json Script Command

Added convenience command:
```bash
npm run test-orders
```

### 3. Documentation: `scripts/README.md`

Added comprehensive documentation section covering:
- Quick start guide
- How the script works
- Configuration options
- Troubleshooting guide
- Cleanup instructions

## How to Use

### Prerequisites
- Node.js 20+ installed
- Supabase environment variables configured in `.env`
- A Shopify store (revoatest) with at least one product

### Run the Script

Simply execute:
```bash
npm run test-orders
```

Or directly:
```bash
npx tsx scripts/create-test-orders.ts
```

### What Happens

1. Script fetches revoatest store credentials from Supabase
2. Queries Shopify for the first available product
3. Creates 100 draft orders with:
   - Single line item (quantity: 1)
   - Random customer names
   - Test email addresses (test-customer-1@example.com, etc.)
   - Standard test shipping/billing addresses
   - Note: "Test order #X - Generated by test script"
4. Completes each draft order immediately
5. Logs progress every 10 orders
6. Provides summary with success/failure counts

### Expected Output

```
=================================
Test Order Creation Script
=================================

ğŸ“¦ Initializing Supabase client...
ğŸ” Fetching revoatest store credentials...
âœ… Found store: revoatest.myshopify.com
ğŸ“¦ Fetching products from store...
âœ… Using product: Test Product
   Variant: Default Title ($29.99)

ğŸš€ Creating 100 test orders...

âœ… Created 10/100 orders (10 successful, 0 failed)
âœ… Created 20/100 orders (20 successful, 0 failed)
âœ… Created 30/100 orders (30 successful, 0 failed)
âœ… Created 40/100 orders (40 successful, 0 failed)
âœ… Created 50/100 orders (50 successful, 0 failed)
âœ… Created 60/100 orders (60 successful, 0 failed)
âœ… Created 70/100 orders (70 successful, 0 failed)
âœ… Created 80/100 orders (80 successful, 0 failed)
âœ… Created 90/100 orders (90 successful, 0 failed)
âœ… Created 100/100 orders (100 successful, 0 failed)

=================================
Summary
=================================
Total orders: 100
âœ… Successful: 100
âŒ Failed: 0
â±ï¸  Duration: 52.3s
=================================

âœ… All test orders created successfully!
```

## Technical Details

### Rate Limiting
- 500ms delay between requests
- Total execution time: ~50-60 seconds for 100 orders
- Respects Shopify API rate limits

### Order Data Structure
Each order includes:
- **Line Items**: 1 item from the first available product variant
- **Customer**: Random name + sequential test email
- **Addresses**: Standard test US address
- **Note**: Identifies it as a test order for easy filtering
- **Email**: test-customer-{1-100}@example.com

### Error Handling
- Validates Supabase credentials
- Checks store exists
- Verifies products are available
- Catches and reports individual order failures
- Provides detailed error messages

## Testing Subscription Limits

This script is designed to test:
1. Order-based subscription tier limits
2. Subscription blocking logic when limits are exceeded
3. Order count tracking and updates
4. Daily order count cron jobs

### Example Test Flow
1. Run script to create 100 orders
2. Verify subscription status updates correctly
3. Check that blocking logic activates at the right threshold
4. Test notification triggers for limit warnings

## Cleanup

To remove test orders after testing:

### Option 1: Shopify Admin
1. Go to Shopify Admin â†’ Orders
2. Filter by note containing "Generated by test script"
3. Bulk select and archive/delete

### Option 2: Custom Cleanup Script
You could create a companion cleanup script if needed (not included).

## Configuration

Easily configurable constants in the script:
- `NUM_ORDERS`: Number of orders to create (default: 100)
- `DELAY_BETWEEN_REQUESTS`: Rate limit delay in ms (default: 500)
- Customer name pools for variation

## Troubleshooting

### Common Issues

**"Could not find revoatest store"**
- Ensure store exists in `shopify_stores` table
- Check `store_url` contains "revoatest"

**"No products found in store"**
- Create at least one product in Shopify first
- Verify product has at least one variant

**"GraphQL errors"**
- Verify access token is valid
- Check required scopes: `write_orders`, `write_draft_orders`
- Ensure store connection is active

**Rate limit errors**
- Increase `DELAY_BETWEEN_REQUESTS` value
- Run during off-peak hours

## Files Modified

1. âœ… Created `scripts/create-test-orders.ts` - Main script implementation
2. âœ… Updated `package.json` - Added `test-orders` command
3. âœ… Updated `scripts/README.md` - Added documentation section
4. âœ… Created `TEST_ORDERS_IMPLEMENTATION.md` - This summary

## Build Verification

Build completed successfully:
- âœ… TypeScript compilation passes
- âœ… Vite build successful
- âœ… No breaking changes
- âœ… All existing functionality intact

## Next Steps

1. Ensure revoatest store has at least one product
2. Run the script: `npm run test-orders`
3. Monitor order creation in Shopify Admin
4. Verify subscription blocking logic responds correctly
5. Test notification systems
6. Clean up test orders when done

## Summary

You now have a simple, reliable way to generate test orders for subscription limit testing. The script is:
- âœ… Standalone and manual (no automation)
- âœ… Simple to run (one command)
- âœ… Well documented
- âœ… Production-ready with error handling
- âœ… Easy to configure and modify
